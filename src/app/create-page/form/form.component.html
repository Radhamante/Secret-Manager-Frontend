<form (ngSubmit)="onSubmit()" [formGroup]="secretForm" card class="max-w-lg">
  <h2 class="mb-4 text-2xl font-bold">
    {{ "form.title" | transloco }}
  </h2>
  <p class="mb-4 text-gray-600 dark:text-gray-500">
    {{ "form.subtitle" | transloco }}
  </p>

  <div class="mb-4">
    <div class="flex items-center">
      <button
        type="button"
        class="flex-1 py-0 py-1 text-sm text-purple-800 border border-purple-800 rounded-md rounded-r-none cursor-pointer dark:text-slate-300"
        (click)="toggleContentType(true)"
        [class.bg-purple-500]="isTextMode"
        [class.dark:bg-purple-700]="isTextMode"
        [class.text-white]="isTextMode"
      >
        {{ "form.contentType.text" | transloco }}
      </button>

      <button
        type="button"
        class="flex-1 py-0 py-1 text-sm text-purple-800 border border-purple-800 rounded-md rounded-l-none cursor-pointer dark:text-slate-300"
        (click)="toggleContentType(false)"
        [class.bg-purple-500]="!isTextMode"
        [class.dark:bg-purple-700]="!isTextMode"
        [class.text-white]="!isTextMode"
      >
        {{ "form.contentType.file" | transloco }}
      </button>
    </div>
    @if (isTextMode) {
    <app-input [label]="'form.labels.content' | transloco">
      <div class="flex-1">
        <textarea
          formControlName="textContent"
          [class.border-red-500]="secretForm.errors?.['textContentOrfileContentRequired'] && secretFormSubmited"
          roundedInput
          rows="5"
        ></textarea>
        @if(secretForm.errors?.['textContentOrfileContentRequired'] &&
        secretFormSubmited){
        <span class="text-sm text-red-500">{{
          "form.error.required" | transloco
        }}</span>
        }
      </div>
    </app-input>
    } @else {
    <app-input [label]="'form.labels.content' | transloco">
      <div class="w-full">
        <input
          type="file"
          formControlName="fileContent"
          roundedInput
          [class.border-red-500]="(secretForm.errors?.['textContentOrfileContentRequired'] || secretForm.get('fileContent')?.invalid)  && secretFormSubmited"
          (change)="onFilePicked($event)"
        />
        @if(secretForm.errors?.['textContentOrfileContentRequired'] &&
        secretFormSubmited){
        <span class="text-sm text-red-500">{{
          "form.error.required" | transloco
        }}</span>
        } @if(secretForm.get('fileContent')?.invalid && secretFormSubmited){
        <span class="text-sm text-red-500">{{
          "form.error.fileToBig" | transloco
        }}</span>
        }
      </div>
    </app-input>
    }
    <app-input [label]="'form.labels.password' | transloco">
      <div class="flex-1">
        <input
          type="password"
          autocomplete="unique-password"
          [class.border-red-500]="
            secretForm.get('password')?.invalid && secretFormSubmited
          "
          formControlName="password"
          roundedInput
        />
        @if(secretForm.get('password')?.invalid && secretFormSubmited){
        <span class="text-sm text-red-500">{{
          "form.error.required" | transloco
        }}</span>
        }
      </div>
    </app-input>
    <app-input [label]="'form.labels.lifetime' | transloco">
      <div class="flex flex-1 gap-1">
        <input
          type="number"
          [class.border-red-500]="secretForm.errors?.['lifetimeOrusageLimitRequired'] && secretFormSubmited"
          formControlName="lifetime"
          class="flex-2"
          roundedInput
          min="0"
          value="0"
        />
        <select
          formControlName="lifetimeType"
          [class.border-red-500]="secretForm.errors?.['lifetimeOrusageLimitRequired'] && secretFormSubmited"
          class="flex-1"
          roundedInput
        >
          @for(lifetimetype of secretLifetimeType; track lifetimetype[0]) {
          <option
            [value]="lifetimetype[1]"
            class="dark:bg-slate-900 dark:text-slate-300"
          >
            {{
              "form.labels.lifetimeTypes." + (lifetimetype[0] | lowercase)
                | transloco
            }}
          </option>
          }
        </select>
      </div>
    </app-input>
    <app-input [label]="'form.labels.usageLimit' | transloco">
      <div class="flex-1">
        <input
          type="number"
          [class.border-red-500]="secretForm.errors && secretFormSubmited"
          formControlName="usageLimit"
          roundedInput
        />
        @if(secretForm.errors?.['lifetimeOrusageLimitRequired'] &&
        secretFormSubmited){
        <span class="text-sm text-red-500">{{
          "form.error.lifetimeOrUsage" | transloco
        }}</span>
        }
      </div>
    </app-input>
  </div>

  <button gradient class="relative w-full">
    @if(formIsLoading){
    <div
      role="status"
      class="absolute inset-0 flex items-center justify-center"
    >
      <app-spinner></app-spinner>
    </div>
    }
    <p [class.scale-0]="formIsLoading">
      {{ "form.labels.submit" | transloco }}
    </p>
  </button>
</form>
